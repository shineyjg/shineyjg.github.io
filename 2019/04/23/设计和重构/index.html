<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计和重构 | 雨中云居</title>
    <meta name="description" content="小步快跑，快速迭代。">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.4d43a9e3.css" as="style"><link rel="preload" href="/assets/js/app.2f09ff3d.js" as="script"><link rel="preload" href="/assets/js/5.74ec0765.js" as="script"><link rel="preload" href="/assets/js/35.2603752d.js" as="script"><link rel="prefetch" href="/assets/js/1.c53ecec0.js"><link rel="prefetch" href="/assets/js/10.023159e0.js"><link rel="prefetch" href="/assets/js/11.025f9b8d.js"><link rel="prefetch" href="/assets/js/12.3b6a83a9.js"><link rel="prefetch" href="/assets/js/13.b9db9f21.js"><link rel="prefetch" href="/assets/js/14.f0a0d27e.js"><link rel="prefetch" href="/assets/js/15.f847b5b1.js"><link rel="prefetch" href="/assets/js/16.1eb044f7.js"><link rel="prefetch" href="/assets/js/17.7f057615.js"><link rel="prefetch" href="/assets/js/18.1c8e69b2.js"><link rel="prefetch" href="/assets/js/19.3a0212e5.js"><link rel="prefetch" href="/assets/js/20.7bd697d2.js"><link rel="prefetch" href="/assets/js/21.8969053f.js"><link rel="prefetch" href="/assets/js/22.2d3de7e9.js"><link rel="prefetch" href="/assets/js/23.4d86525b.js"><link rel="prefetch" href="/assets/js/24.53c1b64a.js"><link rel="prefetch" href="/assets/js/25.18f85102.js"><link rel="prefetch" href="/assets/js/26.aea4a9de.js"><link rel="prefetch" href="/assets/js/27.2819c090.js"><link rel="prefetch" href="/assets/js/28.417cefb4.js"><link rel="prefetch" href="/assets/js/29.b9848050.js"><link rel="prefetch" href="/assets/js/30.3bba88f0.js"><link rel="prefetch" href="/assets/js/31.3a0210cd.js"><link rel="prefetch" href="/assets/js/32.5e927a02.js"><link rel="prefetch" href="/assets/js/33.cb43ca24.js"><link rel="prefetch" href="/assets/js/34.c0e2184c.js"><link rel="prefetch" href="/assets/js/36.5d2b162a.js"><link rel="prefetch" href="/assets/js/37.df45725b.js"><link rel="prefetch" href="/assets/js/38.8ec22f07.js"><link rel="prefetch" href="/assets/js/39.3d68f7b8.js"><link rel="prefetch" href="/assets/js/4.de60fea4.js"><link rel="prefetch" href="/assets/js/40.3a19b469.js"><link rel="prefetch" href="/assets/js/41.500fc3dd.js"><link rel="prefetch" href="/assets/js/42.6ac9cf39.js"><link rel="prefetch" href="/assets/js/43.c3ad6aac.js"><link rel="prefetch" href="/assets/js/44.61e4ad80.js"><link rel="prefetch" href="/assets/js/45.37bb92ea.js"><link rel="prefetch" href="/assets/js/6.1b229177.js"><link rel="prefetch" href="/assets/js/7.bd2e9573.js"><link rel="prefetch" href="/assets/js/8.838426a4.js"><link rel="prefetch" href="/assets/js/9.1b478aea.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.e02251a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d43a9e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">雨中云居 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/essay/" class="nav-link">软件随笔</a></li><li class="nav-item"><a href="/ms/" class="nav-link">微服务</a></li><li class="nav-item"><a href="/frontend/" class="nav-link">前端</a></li><li class="nav-item"><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">雨中云居 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/essay/" class="nav-link">软件随笔</a></li><li class="mobile-nav-item"><a href="/ms/" class="nav-link">微服务</a></li><li class="mobile-nav-item"><a href="/frontend/" class="nav-link">前端</a></li><li class="mobile-nav-item"><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        设计和重构
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2019-04-23T00:00:00.000Z">
      2019-04-23
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/软件随笔" data-v-d832e844> 软件随笔 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/设计" data-v-d832e844> 设计 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/重构" data-v-d832e844> 重构 </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>在软件行业，经常听到：“先设计后实现”，也经常听到：“设计的重要性”。</p> <p>在软件实现过程中，却往往很难做到。因为大多数实现者在编程的时刻，最关注的是功能的实现，不会考虑太多以后是否易于维护，易于扩展，性能如何等问题。 功能有时候也确实很复杂，连功能的实现都让身为程序员的我们已经焦头烂额，还有空考虑设计之类似乎虚无缥缈的东西？！而一旦该功能成型，迫于项目时间压力，我们会把时间精力立马投入到另一个功能的实现或另一个项目实现中......等到下次修改bug，或增添新的功能的时候，问题就出现了：改一处小小的代码，会影响其他功能，还会引起其他bug。为了更改bug，这时候的程序员反应一般有两种:</p> <ul><li>在现有代码上改，用全局变量或其它标识来区分之前的和现在的不同情况，结果是代码到处是各种流程，复杂到你自己都看不懂;</li> <li>把相关代码拷贝一份，保持旧的代码不变（为的是不影响既有功能），简单更改新的代码，结果是重复代码，如果重复代码本身有问题，以后修正这些重复代码的bug就特别容易遗漏，也无形中增加了维护的难度和成本.</li></ul> <p>很显然这两种方式，都会使代码越来越糟糕，越来越难以维护，就像一个大热天一直放着的馒头，越变越馊，而身为程序员却还得过个3/5天甚至3/5个月来啃一口这个变馊的馒头。</p> <p>出现这个问题的一个重要原因是因为没有在合适的时机进行代码重构。</p> <p>实现功能的时候能够考虑设计原则当然是好，但正如前面说的，有各种原因导致当时进行设计是很难的，而且在没有实现功能的时候，往往看不到这个feature的全貌，即使在实现功能之前就设计，设计也未必就是好的，就能保持一成不变，现实中需求变更也是常态，所以也不能指望一开始的设计就能满足最终的需求。</p> <p>有两个时机是合适的重构时机：</p> <ul><li>功能已经完成90%，基本可以看到该feature全貌的时候，在保证通过单元测试的同时，在进行集成测试之前重构代码。</li> <li>功能完成一段时间，集成测试也过了。但第一次系统测试报了一些bug，在解决第一次bug之前，我们需要审视一下我们即将更改的代码是否需要重构。</li></ul> <p>一般遇到以下情况需要警惕，这些强信号在提醒我们：是否需要重构？重构？重构？</p> <ol><li>要通过很多状态来控制复杂流程</li> <li>有一个bug，但很难下手改代码</li> <li>存在重复代码</li> <li>一个软件实体实现太多功能，比如一个文件上千行代码，一个类、一个函数要翻页好几屏才能看到全貌</li></ol> <p>最后再聊下关于如何重构的一点心得，个人觉得比较有效的是使用软件中最最重要的一条原则：“单一职责”这个尺子去度量一下代码。</p> <p>一般可以按下面的步骤：</p> <ul><li>显示和业务分离</li> <li>大模块拆小模块，大文件拆小文件，大函数拆小函数</li> <li>查找消除重复代码</li> <li>考察应用场景是否适合特定的软件设计模式</li></ul> <p>最后一条中的软件设计模式是业界长期实践经验的精华汇总，如果运用得当，将大大简化、标准化设计，更有利于软件的后期维护。设计模式还是高层次的软件通用沟通语言，当我们采用更抽象的设计模式来沟通软件设计和软件问题时，可以用更简短的语言，达到更清晰的描述具体场景和问题的效果。</p> <p>在适当时间点稍微多花点时间重构，确保软件设计可用，可持续，可以为项目后续维护节省更多时间，从我个人经验来看重构前后所需维护时间至少相差一个数量级。</p></div> <footer><!----> <hr> <!----></footer></article> <!----></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-fdbf4940><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-fdbf4940></path></svg>
          
        </a></li><li class="contact-item" data-v-fdbf4940><a href="mailto:shineyjg@gmail.com" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-fdbf4940><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-fdbf4940></path><polyline points="22,6 12,13 2,6" data-v-fdbf4940></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/" class="nav-link" data-v-fdbf4940>Vincent © 2020</a></li></ul></div></footer></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="/assets/js/app.2f09ff3d.js" defer></script><script src="/assets/js/5.74ec0765.js" defer></script><script src="/assets/js/35.2603752d.js" defer></script>
  </body>
</html>
