(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{274:function(t,s,a){t.exports=a.p+"assets/img/arch.8f750986.png"},275:function(t,s,a){t.exports=a.p+"assets/img/cluster.78d655e6.png"},276:function(t,s,a){t.exports=a.p+"assets/img/register.69803416.jpeg"},413:function(t,s,a){"use strict";a.r(s);var r=a(5),e=Object(r.a)({},function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"consul介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#consul介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" consul介绍")]),t._v(" "),r("h3",{attrs:{id:"_1-consul是什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-consul是什么","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.consul是什么")]),t._v(" "),r("p",[t._v("consul是提供服务发现、简单配置管理、分区部署的服务注册发现解决方案。主要特性：")]),t._v(" "),r("ul",[r("li",[t._v("服务发现")]),t._v(" "),r("li",[t._v("健康检查")]),t._v(" "),r("li",[t._v("基于Key-Value的配置")]),t._v(" "),r("li",[t._v("支持TLS安全通讯")]),t._v(" "),r("li",[t._v("支持多数据中心部署")])]),t._v(" "),r("h3",{attrs:{id:"_2-consul架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-consul架构","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. consul架构")]),t._v(" "),r("p",[r("img",{attrs:{src:a(274),alt:"图片",title:"图片"}})]),t._v(" "),r("h3",{attrs:{id:"_3-和其它服务发现软件对比"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-和其它服务发现软件对比","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 和其它服务发现软件对比")]),t._v(" "),r("p",[t._v("略，参见"),r("a",{attrs:{href:"https://www.consul.io/intro/vs/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("consul官网"),r("OutboundLink")],1)]),t._v(" "),r("h3",{attrs:{id:"_4-相关重要概念"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-相关重要概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 相关重要概念")]),t._v(" "),r("ul",[r("li",[t._v("consul的实例叫agent")]),t._v(" "),r("li",[t._v("agent有两种运行模式：server和client")]),t._v(" "),r("li",[t._v("每个数据中心至少要有一个server，一般推荐3-5个server（避免单点故障）")]),t._v(" "),r("li",[t._v("client模式agent是一个轻量级进程，执行健康检查，转发查询请求到server。")]),t._v(" "),r("li",[t._v("服务service是注册到consul的外部应用，比如spring web server")])]),t._v(" "),r("h2",{attrs:{id:"实战"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实战","aria-hidden":"true"}},[t._v("#")]),t._v(" 实战")]),t._v(" "),r("h3",{attrs:{id:"_1-安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 安装")]),t._v(" "),r("p",[t._v("我们采用consul镜像来玩转consul（这就是容器的好处，不用安装，直接用,笔者写文章时最新版本1.2.2）")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker pull consul:1.2.2\n")])])]),r("h3",{attrs:{id:"_2-启动consul-server1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动consul-server1","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 启动consul server1")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker run --name consul1 -d -p 8501:8500 consul:1.2.2 agent -server -bootstrap -ui -bind=0.0.0.0 -client=0.0.0.0\n")])])]),r("p",[t._v("注：")]),t._v(" "),r("ul",[r("li",[t._v("8500 http端口，用于http接口和web ui")]),t._v(" "),r("li",[t._v("8300 server rpc端口：同一数据中心consul server之间通过该端口通信")]),t._v(" "),r("li",[t._v("8301 serf lan端口，同一数据中心consul client通过该端口通信")]),t._v(" "),r("li",[t._v("8302 serf wan端口，不同数据中心consul server通过该端口通信")]),t._v(" "),r("li",[t._v("8600 dns端口，用于服务发现")]),t._v(" "),r("li",[t._v("-bootstrap：集群模式，需要至少两台服务器，才能选举集群leader")]),t._v(" "),r("li",[t._v("-ui: 运行web控制台")]),t._v(" "),r("li",[t._v("-bind： 监听网口，0.0.0.0表示所有网口，如果不指定默认为127.0.0.1，则无法和容器通信")]),t._v(" "),r("li",[t._v("-client：允许客户端ip")])]),t._v(" "),r("h3",{attrs:{id:"_3-获取consul-server1-ip地址"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-获取consul-server1-ip地址","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.获取consul server1 ip地址")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker inspect --format '{{ .NetworkSettings.IPAddress }}' consul1\n")])])]),r("h3",{attrs:{id:"_4-启动consul-server2，并加入consul-server1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-启动consul-server2，并加入consul-server1","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 启动consul server2，并加入consul server1")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker run --name consul2 -d -p 8502:8500 consul agent -server -ui -bind=0.0.0.0 -client=0.0.0.0 -join [consul1 ip address]\n")])])]),r("p",[t._v("注：[consul1 ip address]用第3步获取ip填入")]),t._v(" "),r("h3",{attrs:{id:"_5-启动consul-server3，并加入consul-server1或consul-server2集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动consul-server3，并加入consul-server1或consul-server2集群","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 启动consul server3，并加入consul server1或consul server2集群")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker run --name consul3 -d -p 8503:8500 consul agent -server -ui -bind=0.0.0.0 -client=0.0.0.0 -join [consul1 ip address]\n")])])]),r("p",[t._v("注：[consul1 ip address]用第3步获取ip填入")]),t._v(" "),r("h3",{attrs:{id:"_6-宿主机浏览器访问：-http-localhost-8501-或者-http-localhost-8502或者http-localhost-8503"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-宿主机浏览器访问：-http-localhost-8501-或者-http-localhost-8502或者http-localhost-8503","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.宿主机浏览器访问： http://localhost:8501 或者 http://localhost:8502或者http://localhost:8503")]),t._v(" "),r("p",[r("img",{attrs:{src:a(275),alt:"图片",title:"图片"}})]),t._v(" "),r("h3",{attrs:{id:"_7-停止consul-server3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-停止consul-server3","aria-hidden":"true"}},[t._v("#")]),t._v(" 7. 停止consul server3")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker stop consul3\n")])])]),r("p",[t._v("查看consul web界面，显示一个server node已经不在线")]),t._v(" "),r("h3",{attrs:{id:"_8-通过http接口注册服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-通过http接口注册服务","aria-hidden":"true"}},[t._v("#")]),t._v(" 8. 通过http接口注册服务")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  curl -X PUT --data @test-web.json http://localhost:8500/v1/agent/service/register\n")])])]),r("p",[t._v("test-web.json内容：")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Name"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Tags"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1"')]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Address"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Port"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Meta"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"X-TAG"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testtag"')]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EnableTagOverride"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Check"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DeregisterCriticalServiceAfter"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"90m"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"HTTP"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://baidu.com"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Interval"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10s"')]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("p",[r("img",{attrs:{src:a(276),alt:"图片",title:"图片"}})]),t._v(" "),r("p",[t._v("更改test-web.json中内容id和name为test-web2，向另一台server注册：")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  curl -X PUT --data @test-web.json http://localhost:8501/v1/agent/service/register\n")])])]),r("p",[t._v("刷新web控制台可以看到可用服务增加了：test-web2")]),t._v(" "),r("h3",{attrs:{id:"_9-通过http-api获取某个service可用服务列表"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-通过http-api获取某个service可用服务列表","aria-hidden":"true"}},[t._v("#")]),t._v(" 9. 通过http api获取某个service可用服务列表")]),t._v(" "),r("p",[t._v("宿主机浏览器访问：http://localhost:8500/v1/health/service/test-web1?passing，返回所有通过健康检查的可用test-web1服务列表")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Node"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1e58f720-6b9e-b508-1f28-90b4461268f1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Node"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ca20157ca067"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Address"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.17.0.3"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Datacenter"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dc1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"TaggedAddresses"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lan"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.17.0.3"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"wan"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.17.0.3"')]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Meta"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"consul-network-segment"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CreateIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ModifyIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Service"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Service"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Tags"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Address"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Meta"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"X-TAG"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testtag"')]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Port"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EnableTagOverride"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ProxyDestination"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Connect"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Native"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Proxy"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CreateIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ModifyIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Checks"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Node"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ca20157ca067"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CheckID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serfHealth"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Name"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Serf Health Status"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Status"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"passing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Notes"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Output"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Agent alive and reachable"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ServiceID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ServiceName"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ServiceTags"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Definition"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CreateIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ModifyIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Node"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ca20157ca067"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CheckID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service:test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Name"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"Service 'test-web1' check\"")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Status"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"passing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Notes"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Output"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HTTP GET http://baidu.com: 200 OK Output: <html>\\n<meta http-equiv=\\"refresh\\" content=\\"0;url=http://www.baidu.com/\\">\\n</html>\\n"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ServiceID"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ServiceName"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ServiceTags"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Definition"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CreateIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ModifyIndex"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),r("p",[t._v("注：")]),t._v(" "),r("p",[t._v("其它应用程序可以通过这种方式轮询获取服务列表，这就是微服务能够动态知道其依赖微服务可用列表的原理。")]),t._v(" "),r("h3",{attrs:{id:"_10-解注册"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-解注册","aria-hidden":"true"}},[t._v("#")]),t._v(" 10. 解注册")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  curl -i -X PUT http://IP:PORT/v1/agent/service/deregister/:service_id\n")])])]),r("h3",{attrs:{id:"_11-适合本机调试的更简方式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-适合本机调试的更简方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 11. 适合本机调试的更简方式")]),t._v(" "),r("p",[t._v("上述集群方式需要至少启动两个consul server，本机调试web应用时，为了方便可以用-dev参数方式只启动一个consul server：")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("  docker run --name consul -d -p 8500:8500 consul:1.2.2 agent -dev -bind=0.0.0.0 -client=0.0.0.0\n")])])]),r("p",[t._v("注：")]),t._v(" "),r("p",[t._v("spring boot web应用如何集成consul，参见后续技术分享")])])},[],!1,null,null,null);s.default=e.exports}}]);