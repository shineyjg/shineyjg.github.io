<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>玩转Docker | 雨中云居</title>
    <meta name="description" content="docker介绍">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.4d43a9e3.css" as="style"><link rel="preload" href="/assets/js/app.2f09ff3d.js" as="script"><link rel="preload" href="/assets/js/5.74ec0765.js" as="script"><link rel="preload" href="/assets/js/11.025f9b8d.js" as="script"><link rel="prefetch" href="/assets/js/1.c53ecec0.js"><link rel="prefetch" href="/assets/js/10.023159e0.js"><link rel="prefetch" href="/assets/js/12.3b6a83a9.js"><link rel="prefetch" href="/assets/js/13.b9db9f21.js"><link rel="prefetch" href="/assets/js/14.f0a0d27e.js"><link rel="prefetch" href="/assets/js/15.f847b5b1.js"><link rel="prefetch" href="/assets/js/16.1eb044f7.js"><link rel="prefetch" href="/assets/js/17.7f057615.js"><link rel="prefetch" href="/assets/js/18.1c8e69b2.js"><link rel="prefetch" href="/assets/js/19.3a0212e5.js"><link rel="prefetch" href="/assets/js/20.7bd697d2.js"><link rel="prefetch" href="/assets/js/21.8969053f.js"><link rel="prefetch" href="/assets/js/22.2d3de7e9.js"><link rel="prefetch" href="/assets/js/23.4d86525b.js"><link rel="prefetch" href="/assets/js/24.53c1b64a.js"><link rel="prefetch" href="/assets/js/25.18f85102.js"><link rel="prefetch" href="/assets/js/26.aea4a9de.js"><link rel="prefetch" href="/assets/js/27.2819c090.js"><link rel="prefetch" href="/assets/js/28.417cefb4.js"><link rel="prefetch" href="/assets/js/29.b9848050.js"><link rel="prefetch" href="/assets/js/30.3bba88f0.js"><link rel="prefetch" href="/assets/js/31.3a0210cd.js"><link rel="prefetch" href="/assets/js/32.5e927a02.js"><link rel="prefetch" href="/assets/js/33.cb43ca24.js"><link rel="prefetch" href="/assets/js/34.c0e2184c.js"><link rel="prefetch" href="/assets/js/35.2603752d.js"><link rel="prefetch" href="/assets/js/36.5d2b162a.js"><link rel="prefetch" href="/assets/js/37.df45725b.js"><link rel="prefetch" href="/assets/js/38.8ec22f07.js"><link rel="prefetch" href="/assets/js/39.3d68f7b8.js"><link rel="prefetch" href="/assets/js/4.de60fea4.js"><link rel="prefetch" href="/assets/js/40.3a19b469.js"><link rel="prefetch" href="/assets/js/41.500fc3dd.js"><link rel="prefetch" href="/assets/js/42.6ac9cf39.js"><link rel="prefetch" href="/assets/js/43.c3ad6aac.js"><link rel="prefetch" href="/assets/js/44.61e4ad80.js"><link rel="prefetch" href="/assets/js/45.37bb92ea.js"><link rel="prefetch" href="/assets/js/6.1b229177.js"><link rel="prefetch" href="/assets/js/7.bd2e9573.js"><link rel="prefetch" href="/assets/js/8.838426a4.js"><link rel="prefetch" href="/assets/js/9.1b478aea.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.e02251a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d43a9e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">雨中云居 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/essay/" class="nav-link">软件随笔</a></li><li class="nav-item"><a href="/ms/" class="nav-link">微服务</a></li><li class="nav-item"><a href="/frontend/" class="nav-link">前端</a></li><li class="nav-item"><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">雨中云居 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/essay/" class="nav-link">软件随笔</a></li><li class="mobile-nav-item"><a href="/ms/" class="nav-link">微服务</a></li><li class="mobile-nav-item"><a href="/frontend/" class="nav-link">前端</a></li><li class="mobile-nav-item"><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        玩转Docker
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2018-08-24T00:00:00.000Z">
      2018-08-24
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/微服务" data-v-d832e844> 微服务 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/docker" data-v-d832e844> docker </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="docker简述"><a href="#docker简述" aria-hidden="true" class="header-anchor">#</a> Docker简述</h2> <p>Docker是基于Go语言实现的开源应用容器引擎。</p> <p>Docker通过对应用组件的封装、分发、部署、运行等生命周期的管理，达到应用组件级别的“一次封装，到处运行”。
这里的应用组件，既可以是Web应用，也可以是一套数据库服务，甚至是一个操作系统或编译器。</p> <p>Docker由镜像(Image)、容器(Container)、仓库(Registry) 三大核心组成。</p> <ul><li>镜像： 类似操作系统备份时制作的安装镜像，是操作系统和软件的集合，镜像制作好之后是只读的。</li> <li>容器：
<ul><li>把镜像代表的系统和软件运行起来就是容器，由一个镜像可以运行多个容器实例。</li> <li>容器可以被启动、停止、删除。容器之间相互隔离。</li> <li>容器可以类比为通过系统镜像安装并运行的操作系统和软件。</li></ul></li> <li>仓库：
<ul><li><p>集中存放镜像文件的地方，有本地仓库和远程仓库。</p></li> <li><p>默认远程仓库是docker官方仓库（对应web地址：https://hub.docker.com ）。</p></li> <li><p>运行容器之前必须有本地镜像，本地镜像不存在，则从远程仓库先拉取镜像到本地。</p></li> <li><p>同名字不同标签的镜像组成了repository。比如</p> <ul><li>maven:3.3.2</li> <li>...</li> <li>maven:3.5.3</li> <li>maven:latest</li></ul> <p>组成了maven镜像repository，所有repository组成仓库。</p></li></ul></li></ul> <h2 id="为什么docker"><a href="#为什么docker" aria-hidden="true" class="header-anchor">#</a> 为什么Docker</h2> <ul><li>更快速的交付和部署环境： 避免开发、测试、运维环境的差异导致的各种问题</li> <li>更轻松的迁移和扩展： docker容器可以在任何平台一致运行</li> <li>更简单的软件环境更新管理：通过简单的文本文件Dockerfile管理复杂软件环境的变化</li></ul> <p>容器和虚拟机对比</p> <table><thead><tr><th>特性</th> <th>容器</th> <th>虚拟机</th></tr></thead> <tbody><tr><td>启动</td> <td>秒级</td> <td>分钟级</td></tr> <tr><td>磁盘占用</td> <td>一般MB</td> <td>一般GB</td></tr> <tr><td>性能</td> <td>接近原生</td> <td>较差</td></tr> <tr><td>系统支持数量</td> <td>单机可支持上百乃至上千个容器</td> <td>一般几十个</td></tr></tbody></table> <h2 id="docke实战"><a href="#docke实战" aria-hidden="true" class="header-anchor">#</a> docke实战</h2> <h3 id="_1-docker安装"><a href="#_1-docker安装" aria-hidden="true" class="header-anchor">#</a> 1. docker安装</h3> <p>在官网下载docker desktop安装即可，略。</p> <h3 id="_2-实战：列出所有本地镜像"><a href="#_2-实战：列出所有本地镜像" aria-hidden="true" class="header-anchor">#</a> 2. 实战：列出所有本地镜像</h3> <div class="language- extra-class"><pre class="language-text"><code>docker images
</code></pre></div><p>输出：</p> <p><img src="/assets/img/images.433e477c.jpeg" alt="图片" title="图片"></p> <p>注：本文所有命令均在命令行窗口中运行。</p> <h3 id="_3-实战：拉取alpine镜像到本地"><a href="#_3-实战：拉取alpine镜像到本地" aria-hidden="true" class="header-anchor">#</a> 3. 实战：拉取alpine镜像到本地</h3> <div class="language- extra-class"><pre class="language-text"><code>docker pull alpine 
</code></pre></div><p>注：不指定tag，默认latest，相当于：</p> <div class="language- extra-class"><pre class="language-text"><code>docker pull alpine:latest
</code></pre></div><p>注：</p> <ul><li>alpine是小巧、安全、简单、适合容器使用的linux操作系统。</li> <li>非常适合作为容器的基础镜像使用，具体见镜像制作章节内容。</li> <li>最新alpine镜像大小不到5M！具体参见<a href="https://www.alpinelinux.org" target="_blank" rel="noopener noreferrer">alpine官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>如果想查看所有alpine的repository，特别是有哪些版本，可以访问<a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">docker hub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 搜索alpine即可</li> <li>一般不建议latest这个tag，因为latest会随着时间变化，而且latest可能落后其它版本。</li></ul> <h3 id="_4-实战：拉取maven-3-5-3镜像"><a href="#_4-实战：拉取maven-3-5-3镜像" aria-hidden="true" class="header-anchor">#</a> 4. 实战：拉取maven 3.5.3镜像</h3> <div class="language- extra-class"><pre class="language-text"><code>docker pull maven:3.5.3 
</code></pre></div><p>注：</p> <ul><li>拉取下来的镜像会以文件的方式保存在本机电脑中，如果拉取了大量镜像，可能会占用较多的磁盘空间。</li> <li>除非显式删除本机镜像，镜像会一直保存，即使关机再开机也还存在。</li></ul> <h3 id="_5-实战：运行alpine镜像的容器"><a href="#_5-实战：运行alpine镜像的容器" aria-hidden="true" class="header-anchor">#</a> 5. 实战：运行alpine镜像的容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker run --name myalpine -it alpine:3.9.3
</code></pre></div><p><img src="/assets/img/run.e6037a61.jpeg" alt="图片" title="图片"></p> <p>注：</p> <ul><li>首次run，如果本地还没有相关镜像，会自动先拉取镜像</li> <li>--name指定容器名字后，之后对该容器的操作可以用名字参数来区分，而不用记长而难记的容器id来操作容器。</li> <li>-it指定以交互模式+伪总端的前台方式运行容器，也就是说容器运行起来之后，已经通过伪终端进入到容器内部，可以和容器交互了。</li> <li>退出交互模式的容器：在终端输入exit命令。</li></ul> <p>如果以后台方式运行：</p> <div class="language- extra-class"><pre class="language-text"><code>docker run --name myalpine -d alpine:3.9.3
</code></pre></div><p>会发现容器马上停止了，因为容器后台运行要求容器内部至少有一个前台进程在跑。</p> <p>在本例中容器内部没有前台进程所以直接退出了。所以说alpine是基础镜像，我们需要在此基础上跑我们的应用程序，最终生成我们自己的镜像。参见后面创建镜像章节内容。</p> <h3 id="_6-实战：-查看正在运行的容器"><a href="#_6-实战：-查看正在运行的容器" aria-hidden="true" class="header-anchor">#</a> 6. 实战： 查看正在运行的容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker ps
</code></pre></div><p><img src="/assets/img/ps.1ca12dda.jpeg" alt="图片" title="图片"></p> <h3 id="_7-实战：-查看所有容器（包括正在运行的和已经停止的）"><a href="#_7-实战：-查看所有容器（包括正在运行的和已经停止的）" aria-hidden="true" class="header-anchor">#</a> 7. 实战： 查看所有容器（包括正在运行的和已经停止的）</h3> <div class="language- extra-class"><pre class="language-text"><code>docker ps -a
</code></pre></div><p><img src="/assets/img/ps_a.26946f46.jpeg" alt="图片" title="图片"></p> <h3 id="_8-实战：停止alphine容器"><a href="#_8-实战：停止alphine容器" aria-hidden="true" class="header-anchor">#</a> 8. 实战：停止alphine容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker stop myalpine 
</code></pre></div><h3 id="_9-实战：启动容器（不是从镜像创建，而是已经存在但停止运行的容器）"><a href="#_9-实战：启动容器（不是从镜像创建，而是已经存在但停止运行的容器）" aria-hidden="true" class="header-anchor">#</a> 9. 实战：启动容器（不是从镜像创建，而是已经存在但停止运行的容器）</h3> <div class="language- extra-class"><pre class="language-text"><code>docker start myalpine
</code></pre></div><h3 id="_10-实战：进入容器"><a href="#_10-实战：进入容器" aria-hidden="true" class="header-anchor">#</a> 10. 实战：进入容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker exec -it myalpine sh
</code></pre></div><p><img src="/assets/img/enter.197bdd0c.jpeg" alt="图片" title="图片"></p> <h3 id="_11-实战：-重启容器"><a href="#_11-实战：-重启容器" aria-hidden="true" class="header-anchor">#</a> 11. 实战： 重启容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker restart myalpine
</code></pre></div><h3 id="_12-实战：删除myalpine容器"><a href="#_12-实战：删除myalpine容器" aria-hidden="true" class="header-anchor">#</a> 12. 实战：删除myalpine容器</h3> <div class="language- extra-class"><pre class="language-text"><code>docker rm myalpine
</code></pre></div><p>注： 删除容器之前必须停止容器</p> <h3 id="_13-实战：删除本地alpine镜像"><a href="#_13-实战：删除本地alpine镜像" aria-hidden="true" class="header-anchor">#</a> 13. 实战：删除本地alpine镜像</h3> <div class="language- extra-class"><pre class="language-text"><code>docker rmi myalpine
</code></pre></div><p>注：在删除本地镜像之前，必须删除所有该镜像生成的容器</p> <h3 id="_14-实战：从容器制作镜像"><a href="#_14-实战：从容器制作镜像" aria-hidden="true" class="header-anchor">#</a> 14. 实战：从容器制作镜像</h3> <h4 id="_14-1-启动并进入alpine容器，在容器中执行命令"><a href="#_14-1-启动并进入alpine容器，在容器中执行命令" aria-hidden="true" class="header-anchor">#</a> 14.1 启动并进入alpine容器，在容器中执行命令</h4> <div class="language- extra-class"><pre class="language-text"><code>apk add --update openssh
</code></pre></div><h4 id="_14-2-退出容器"><a href="#_14-2-退出容器" aria-hidden="true" class="header-anchor">#</a> 14.2 退出容器</h4> <h4 id="_14-3-停止容器"><a href="#_14-3-停止容器" aria-hidden="true" class="header-anchor">#</a> 14.3 停止容器</h4> <h4 id="_14-5-创建镜像"><a href="#_14-5-创建镜像" aria-hidden="true" class="header-anchor">#</a> 14.5 创建镜像</h4> <div class="language- extra-class"><pre class="language-text"><code>docker commit -m &quot;install openssh&quot; myalpine alpine-ssh
</code></pre></div><h4 id="_14-6-查看镜像是否创建"><a href="#_14-6-查看镜像是否创建" aria-hidden="true" class="header-anchor">#</a> 14.6 查看镜像是否创建</h4> <div class="language- extra-class"><pre class="language-text"><code>docker images
</code></pre></div><h4 id="_14-7-从新的镜像启动新容器"><a href="#_14-7-从新的镜像启动新容器" aria-hidden="true" class="header-anchor">#</a> 14.7 从新的镜像启动新容器</h4> <div class="language- extra-class"><pre class="language-text"><code>docker run --name -it myalphine-ssh alpine-ssh sh
</code></pre></div><p>注：第14小节这种方式创建镜像不够灵活，尽量用第15小节的方式创建镜像，这里只要了解即可。</p> <h3 id="_15-从dockerfile制作镜像"><a href="#_15-从dockerfile制作镜像" aria-hidden="true" class="header-anchor">#</a> 15. 从Dockerfile制作镜像</h3> <h4 id="_15-1-创建文件dockerfile，内容如下"><a href="#_15-1-创建文件dockerfile，内容如下" aria-hidden="true" class="header-anchor">#</a> 15.1 创建文件Dockerfile，内容如下</h4> <div class="language- extra-class"><pre class="language-text"><code>FROM alpine:latest
MAINTAINER yangjianguang &lt;yangjianguang@zhuojianchina.com&gt;
RUN apk add --update openssh
RUN ssh-keygen -f /etc/ssh/ssh_host_rsa_key -N '' -t rsa
RUN sed -i &quot;s/UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g&quot; /etc/ssh/sshd_config &amp;&amp; sed -i &quot;s/UsePAM.*/UsePAM no/g&quot; /etc/ssh/sshd_config &amp;&amp; sed -i &quot;s/PermitRootLogin.*/PermitRootLogin yes/g&quot; /etc/ssh/sshd_config &amp;&amp; sed -i &quot;s/#AuthorizedKeysFile/AuthorizedKeysFile/g&quot; /etc/ssh/sshd_config
EXPOSE 22
CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;]
</code></pre></div><p>注：</p> <ul><li>FROM指定从哪个基础镜像制作我们自己的镜像</li> <li>RUN命令安装一些软件</li> <li>EXPOSE指定暴露到容器外面的端口（这里只是声明容器需要暴露的端口，真正暴露出去还需做显式端口映射：见运行容器时的-p参数或隐式端口映射：见运行容器时的-P参数）</li> <li>CMD指明容器启动后执行的程序</li></ul> <h4 id="_15-2-制作镜像，在包含dockerfile的目录的终端中执行"><a href="#_15-2-制作镜像，在包含dockerfile的目录的终端中执行" aria-hidden="true" class="header-anchor">#</a> 15.2 制作镜像，在包含Dockerfile的目录的终端中执行</h4> <div class="language- extra-class"><pre class="language-text"><code>docker build -t alpine-ssh .
</code></pre></div><p><img src="/assets/img/build.a441e438.jpeg" alt="图片" title="图片"></p> <p>注：这里生成镜像的时候，没有指定tag，默认为latest，作为最佳实践，最好指定tag为具体版本号字符串。</p> <h4 id="_15-3-查看新生成的镜像"><a href="#_15-3-查看新生成的镜像" aria-hidden="true" class="header-anchor">#</a> 15.3 查看新生成的镜像</h4> <div class="language- extra-class"><pre class="language-text"><code>docker images
</code></pre></div><h4 id="_15-4-基于新的镜像运行容器"><a href="#_15-4-基于新的镜像运行容器" aria-hidden="true" class="header-anchor">#</a> 15.4 基于新的镜像运行容器</h4> <div class="language- extra-class"><pre class="language-text"><code>docker run --name alpine-ssh -p 8122:22 -d alpine-ssh
</code></pre></div><p>注：</p> <ul><li>-p参数进行了端口映射，把本机8122端口映射成容器的22端口</li> <li>-d以后台方式启动容器</li></ul> <h4 id="_15-5-进入容器"><a href="#_15-5-进入容器" aria-hidden="true" class="header-anchor">#</a> 15.5 进入容器</h4> <div class="language- extra-class"><pre class="language-text"><code>docker exec -it alpine-ssh sh
</code></pre></div><p>在容器中执行：</p> <div class="language- extra-class"><pre class="language-text"><code>adduser admin
    [输入admin密码]
</code></pre></div><h4 id="_15-6-另起一个终端，ssh远程连接容器"><a href="#_15-6-另起一个终端，ssh远程连接容器" aria-hidden="true" class="header-anchor">#</a> 15.6 另起一个终端，ssh远程连接容器</h4> <div class="language- extra-class"><pre class="language-text"><code>ssh -p 8122 admin@127.0.0.1
   [输入admin密码]
</code></pre></div><p>注：</p> <ul><li>由于做了端口映射，访问本机8122端口相当与访问容器的22端口</li> <li>一般不建议在容器中开启ssh：一个原因是安全隐患，另一个原因为了让容器更轻量，更健壮，除了目标应用和必要依赖软件，不建议装任何其它应用软件。</li> <li>本节只是讲解如何在基础镜像上安装软件，并生成新的镜像原理，再次声明：一般不要在容器中开启ssh！</li></ul> <h2 id="进阶内容"><a href="#进阶内容" aria-hidden="true" class="header-anchor">#</a> 进阶内容</h2> <h3 id="_1-文件操作"><a href="#_1-文件操作" aria-hidden="true" class="header-anchor">#</a> 1. 文件操作</h3> <p>有时候在测试调整容器的时候，需要经常更新容器内文件，可以在宿主机和容器之间进行文件拷贝操作。</p> <h4 id="_1-1-从宿主机拷贝文件或目录到容器内"><a href="#_1-1-从宿主机拷贝文件或目录到容器内" aria-hidden="true" class="header-anchor">#</a> 1.1 从宿主机拷贝文件或目录到容器内</h4> <div class="language- extra-class"><pre class="language-text"><code>docker cp ./nginx.conf nginx:/etc/nginx/
</code></pre></div><p>注：此处最后一个参数冒号之前的nginx是容器名</p> <h4 id="_1-2-从容器拷贝文件或目录到宿主机"><a href="#_1-2-从容器拷贝文件或目录到宿主机" aria-hidden="true" class="header-anchor">#</a> 1.2 从容器拷贝文件或目录到宿主机</h4> <div class="language- extra-class"><pre class="language-text"><code>docker cp nginx:/etc/nginx/nginx.conf ./nginx.conf
</code></pre></div><p>注：此处第一个参数冒号之前的nginx是容器名</p> <h3 id="_2-目录映射"><a href="#_2-目录映射" aria-hidden="true" class="header-anchor">#</a> 2. 目录映射</h3> <p>有三种典型场景需要进行宿主机和容器之间进行目录映射：</p> <ul><li>（1）某些开发场景中，源文件所在整个目录都在宿主机，而执行环境在容器，为了方便调试，不用每次拷贝更改的文件到容器，再进行运行调试，可以进行目录映射。这样容器和宿主机共享了目录及其中文件内容。 比如，调试openresty的lua脚本程序，则可以这样启动容器：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker run --name=&quot;openresty&quot; -d -p 8080:80 -v /Users/yangjianguang/workspace/zhuojian/microservice/rubiku-vue/openresty:/usr/local/openresty/nginx/project -v /Users/yangjianguang/logs:/usr/local/openresty/nginx/logs -v /Users/yangjianguang/workspace/zhuojian/microservice/openresty-gray/src/gray:/usr/local/openresty/lualib/gray openresty/openresty:1.13.6.2-alpine
</code></pre></div><p>注：</p> <p>这里做了三个目录映射：a. html/css/js静态资源 b. 日志 c. 调试的lua脚本
这样只要在本机更改静态资源和lua脚本，容器中的nginx进程就能取到最新文件进行调试，调试出错时容器进程输出的日志文件内容也可以直接在宿主机查看。</p> <ul><li><p>（2）容器运行过程中会生成一些文件，我们希望在销毁容器，重新从镜像运行新的容器时（比如由于镜像升级时希望升级容器）不希望这些文件丢失，可以进行目录映射，让容器输出文件的目录映射到宿主机上。</p></li> <li><p>（3）两个容器希望进行目录共享，则可以把宿主机上同一个目录映射到两个容器内。</p></li></ul> <h3 id="_3-镜像仓库"><a href="#_3-镜像仓库" aria-hidden="true" class="header-anchor">#</a> 3. 镜像仓库</h3> <p>通过docker build或docker commit创建的新镜像经常需要推送到远程镜像仓库中，以便测试、生产等环境拉取镜像并运行容器</p> <h4 id="_3-1-官方仓库"><a href="#_3-1-官方仓库" aria-hidden="true" class="header-anchor">#</a> 3.1 官方仓库</h4> <ul><li><p>（1）在<a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">https://hub.docker.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 注册帐号，如shineyjg</p></li> <li><p>（2）登录官方仓库</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker login -u shineyjg registry.hub.docker.com
</code></pre></div><p>这里可以省略registry.hub.docker.com, docker login命令默认连接的就是官方的镜像仓库</p> <p>注：这里需要输入注册时密码</p> <ul><li>（3）推送镜像到官方仓库</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker push shineyjg/get-started:0.1
</code></pre></div><p>其中shineyjg/get-started:0.1时通过docker build或docker commit生成的测试镜像</p> <p>这里其实省略了仓库地址，默认为官方仓库</p> <h4 id="_3-2-其它仓库"><a href="#_3-2-其它仓库" aria-hidden="true" class="header-anchor">#</a> 3.2 其它仓库</h4> <ul><li><p>（1）在推送镜像到其它仓库之前需要从管理员那里拿到帐号信息，或者仓库本身是开放的，不用登录，则可以略过这一步和下一步</p></li> <li><p>（2) 登录</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker login -u [password] [registry-server-address]
</code></pre></div><ul><li>（3）生成镜像（要求已经准备好Dockerfile，也可以通过其它方式生成镜像）</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker build -t [registry-server-address]/[images-name-and-tag] .
</code></pre></div><ul><li>（4）推送</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker push [registry-server-address]/[images-name-and-tag]
</code></pre></div><h4 id="_3-3-玩转私有仓库"><a href="#_3-3-玩转私有仓库" aria-hidden="true" class="header-anchor">#</a> 3.3 玩转私有仓库</h4> <ul><li>（1）直接启动官方registry镜像容器</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker run --name registry -d -p 5000:5000 -v /Users/yangjianguang/sw/dockerregistry/data:/var/lib/registry registry:2.7.1
</code></pre></div><ul><li>（2）设置docker，添加非安全registry（本机ip地址为192.168.30.52， 这一步也可以通过修改配置文件daemon.json来实现），并重启docker</li></ul> <p><img src="/assets/img/insecure.c31a91a5.png" alt="图片" title="图片"></p> <ul><li>（3）重新给镜像打标签，以便符合格式：[registry-server-address]/[image-name-and-tag]</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker tag alpine:3.9.3 192.168.30.52:5000/alpine:3.9.3
</code></pre></div><ul><li>（4）推送镜像到本地仓库</li></ul> <div class="language- extra-class"><pre class="language-text"><code>docker push 192.168.30.52:5000/alpine:3.9.3
</code></pre></div><p>以后就可以通过本地仓库进行镜像操作，如pull，push。你也可以把你搭建的仓库开放出去（主要是端口开放），让局域网中其它docker客户端来pull或push镜像。</p> <h3 id="_4-查看镜像或容器具体信息，如镜像大小，父镜像，容器ip（需要容器在运行状态），容器目录映射，容器端口映射等"><a href="#_4-查看镜像或容器具体信息，如镜像大小，父镜像，容器ip（需要容器在运行状态），容器目录映射，容器端口映射等" aria-hidden="true" class="header-anchor">#</a> 4. 查看镜像或容器具体信息，如镜像大小，父镜像，容器ip（需要容器在运行状态），容器目录映射，容器端口映射等</h3> <div class="language- extra-class"><pre class="language-text"><code>docker inspect [image-id or container-id]
</code></pre></div><p>还可以过滤输出，直接拿到想要的数据，如获取容器nginx的ip地址：</p> <div class="language- extra-class"><pre class="language-text"><code>docker inspect --format '{{ .NetworkSettings.IPAddress }}' nginx  
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#docker简述" title="Docker简述">Docker简述</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#为什么docker" title="为什么Docker">为什么Docker</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#docke实战" title="docke实战">docke实战</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1-docker安装" title="1. docker安装">1. docker安装</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-实战：列出所有本地镜像" title="2. 实战：列出所有本地镜像">2. 实战：列出所有本地镜像</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-实战：拉取alpine镜像到本地" title="3. 实战：拉取alpine镜像到本地">3. 实战：拉取alpine镜像到本地</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-实战：拉取maven-3-5-3镜像" title="4. 实战：拉取maven 3.5.3镜像">4. 实战：拉取maven 3.5.3镜像</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_5-实战：运行alpine镜像的容器" title="5. 实战：运行alpine镜像的容器">5. 实战：运行alpine镜像的容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_6-实战：-查看正在运行的容器" title="6. 实战： 查看正在运行的容器">6. 实战： 查看正在运行的容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_7-实战：-查看所有容器（包括正在运行的和已经停止的）" title="7. 实战： 查看所有容器（包括正在运行的和已经停止的）">7. 实战： 查看所有容器（包括正在运行的和已经停止的）</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_8-实战：停止alphine容器" title="8. 实战：停止alphine容器">8. 实战：停止alphine容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_9-实战：启动容器（不是从镜像创建，而是已经存在但停止运行的容器）" title="9. 实战：启动容器（不是从镜像创建，而是已经存在但停止运行的容器）">9. 实战：启动容器（不是从镜像创建，而是已经存在但停止运行的容器）</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_10-实战：进入容器" title="10. 实战：进入容器">10. 实战：进入容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_11-实战：-重启容器" title="11. 实战： 重启容器">11. 实战： 重启容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_12-实战：删除myalpine容器" title="12. 实战：删除myalpine容器">12. 实战：删除myalpine容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_13-实战：删除本地alpine镜像" title="13. 实战：删除本地alpine镜像">13. 实战：删除本地alpine镜像</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_14-实战：从容器制作镜像" title="14. 实战：从容器制作镜像">14. 实战：从容器制作镜像</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_15-从dockerfile制作镜像" title="15. 从Dockerfile制作镜像">15. 从Dockerfile制作镜像</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#进阶内容" title="进阶内容">进阶内容</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1-文件操作" title="1. 文件操作">1. 文件操作</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-目录映射" title="2. 目录映射">2. 目录映射</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-镜像仓库" title="3. 镜像仓库">3. 镜像仓库</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-查看镜像或容器具体信息，如镜像大小，父镜像，容器ip（需要容器在运行状态），容器目录映射，容器端口映射等" title="4. 查看镜像或容器具体信息，如镜像大小，父镜像，容器ip（需要容器在运行状态），容器目录映射，容器端口映射等">4. 查看镜像或容器具体信息，如镜像大小，父镜像，容器ip（需要容器在运行状态），容器目录映射，容器端口映射等</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-fdbf4940><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-fdbf4940></path></svg>
          
        </a></li><li class="contact-item" data-v-fdbf4940><a href="mailto:shineyjg@gmail.com" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-fdbf4940><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-fdbf4940></path><polyline points="22,6 12,13 2,6" data-v-fdbf4940></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/" class="nav-link" data-v-fdbf4940>Vincent © 2020</a></li></ul></div></footer></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="/assets/js/app.2f09ff3d.js" defer></script><script src="/assets/js/5.74ec0765.js" defer></script><script src="/assets/js/11.025f9b8d.js" defer></script>
  </body>
</html>
