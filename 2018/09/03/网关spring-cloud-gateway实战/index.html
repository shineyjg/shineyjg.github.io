<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网关Spring Cloud Gateway实战 | 雨中云居</title>
    <meta name="description" content="网关Spring Cloud Gateway实战step by step">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.4d43a9e3.css" as="style"><link rel="preload" href="/assets/js/app.2f09ff3d.js" as="script"><link rel="preload" href="/assets/js/5.74ec0765.js" as="script"><link rel="preload" href="/assets/js/24.53c1b64a.js" as="script"><link rel="prefetch" href="/assets/js/1.c53ecec0.js"><link rel="prefetch" href="/assets/js/10.023159e0.js"><link rel="prefetch" href="/assets/js/11.025f9b8d.js"><link rel="prefetch" href="/assets/js/12.3b6a83a9.js"><link rel="prefetch" href="/assets/js/13.b9db9f21.js"><link rel="prefetch" href="/assets/js/14.f0a0d27e.js"><link rel="prefetch" href="/assets/js/15.f847b5b1.js"><link rel="prefetch" href="/assets/js/16.1eb044f7.js"><link rel="prefetch" href="/assets/js/17.7f057615.js"><link rel="prefetch" href="/assets/js/18.1c8e69b2.js"><link rel="prefetch" href="/assets/js/19.3a0212e5.js"><link rel="prefetch" href="/assets/js/20.7bd697d2.js"><link rel="prefetch" href="/assets/js/21.8969053f.js"><link rel="prefetch" href="/assets/js/22.2d3de7e9.js"><link rel="prefetch" href="/assets/js/23.4d86525b.js"><link rel="prefetch" href="/assets/js/25.18f85102.js"><link rel="prefetch" href="/assets/js/26.aea4a9de.js"><link rel="prefetch" href="/assets/js/27.2819c090.js"><link rel="prefetch" href="/assets/js/28.417cefb4.js"><link rel="prefetch" href="/assets/js/29.b9848050.js"><link rel="prefetch" href="/assets/js/30.3bba88f0.js"><link rel="prefetch" href="/assets/js/31.3a0210cd.js"><link rel="prefetch" href="/assets/js/32.5e927a02.js"><link rel="prefetch" href="/assets/js/33.cb43ca24.js"><link rel="prefetch" href="/assets/js/34.c0e2184c.js"><link rel="prefetch" href="/assets/js/35.2603752d.js"><link rel="prefetch" href="/assets/js/36.5d2b162a.js"><link rel="prefetch" href="/assets/js/37.df45725b.js"><link rel="prefetch" href="/assets/js/38.8ec22f07.js"><link rel="prefetch" href="/assets/js/39.3d68f7b8.js"><link rel="prefetch" href="/assets/js/4.de60fea4.js"><link rel="prefetch" href="/assets/js/40.3a19b469.js"><link rel="prefetch" href="/assets/js/41.500fc3dd.js"><link rel="prefetch" href="/assets/js/42.6ac9cf39.js"><link rel="prefetch" href="/assets/js/43.c3ad6aac.js"><link rel="prefetch" href="/assets/js/44.61e4ad80.js"><link rel="prefetch" href="/assets/js/45.37bb92ea.js"><link rel="prefetch" href="/assets/js/6.1b229177.js"><link rel="prefetch" href="/assets/js/7.bd2e9573.js"><link rel="prefetch" href="/assets/js/8.838426a4.js"><link rel="prefetch" href="/assets/js/9.1b478aea.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.e02251a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d43a9e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">雨中云居 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/essay/" class="nav-link">软件随笔</a></li><li class="nav-item"><a href="/ms/" class="nav-link">微服务</a></li><li class="nav-item"><a href="/frontend/" class="nav-link">前端</a></li><li class="nav-item"><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">雨中云居 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/essay/" class="nav-link">软件随笔</a></li><li class="mobile-nav-item"><a href="/ms/" class="nav-link">微服务</a></li><li class="mobile-nav-item"><a href="/frontend/" class="nav-link">前端</a></li><li class="mobile-nav-item"><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        网关Spring Cloud Gateway实战
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2018-09-03T00:00:00.000Z">
      2018-09-03
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/微服务" data-v-d832e844> 微服务 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/网关" data-v-d832e844> 网关 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Spring Cloud Gateway" data-v-d832e844> Spring Cloud Gateway </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="一、准备工作"><a href="#一、准备工作" aria-hidden="true" class="header-anchor">#</a> 一、准备工作</h2> <h3 id="_1-docker-容器"><a href="#_1-docker-容器" aria-hidden="true" class="header-anchor">#</a> 1. <a href="/2018/08/24/玩转docker/">docker &amp; 容器</a></h3> <h3 id="_2-consul注册发现服务中心"><a href="#_2-consul注册发现服务中心" aria-hidden="true" class="header-anchor">#</a> 2. <a href="/2018/08/26/服务注册发现consul起步/">consul注册发现服务中心</a></h3> <h3 id="_3-provider微服务"><a href="#_3-provider微服务" aria-hidden="true" class="header-anchor">#</a> 3. <a href="/2018/08/29/Provider微服务实战/">Provider微服务</a></h3> <h3 id="_4-consumer微服务"><a href="#_4-consumer微服务" aria-hidden="true" class="header-anchor">#</a> 4. <a href="/2018/08/31/Consumer微服务实战/">consumer微服务</a></h3> <h2 id="二、api网关概念和作用"><a href="#二、api网关概念和作用" aria-hidden="true" class="header-anchor">#</a> 二、API网关概念和作用</h2> <h3 id="角色和概念："><a href="#角色和概念：" aria-hidden="true" class="header-anchor">#</a> 角色和概念：</h3> <p><img src="/assets/img/gateway.77bead1c.png" alt="图片" title="图片"></p> <h3 id="主要作用："><a href="#主要作用：" aria-hidden="true" class="header-anchor">#</a> 主要作用：</h3> <ol><li>统一对外接口</li> <li>统一鉴权</li> <li>服务授权</li> <li>负载均衡</li> <li>灰度</li></ol> <h2 id="三、intellij-idea创建module"><a href="#三、intellij-idea创建module" aria-hidden="true" class="header-anchor">#</a> 三、Intellij IDEA创建module</h2> <h3 id="_1-选择spring-initializr创建名字为gateway的module，dependencies选择"><a href="#_1-选择spring-initializr创建名字为gateway的module，dependencies选择" aria-hidden="true" class="header-anchor">#</a> 1. 选择Spring Initializr创建名字为gateway的module，dependencies选择</h3> <ul><li>actuator</li> <li>consul discovery</li> <li>gateway</li></ul> <p>最终生成pom.xml:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Gateway project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>Finchley.SR1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-修改配置文件src-main-resources-application-properties"><a href="#_2-修改配置文件src-main-resources-application-properties" aria-hidden="true" class="header-anchor">#</a> 2. 修改配置文件src/main/resources/application.properties:</h3> <div class="language- extra-class"><pre class="language-text"><code>spring.application.name = gateway
server.port=9999

spring.cloud.gateway.discovery.locator.enabled=true

spring.cloud.consul.enabled=true
spring.cloud.consul.host=${CONSUL_HOST:127.0.0.1}
spring.cloud.consul.port=${CONSUL_PORT:8500}
spring.cloud.consul.ribbon.enabled=true
spring.cloud.consul.discovery.prefer-ip-address=true
spring.cloud.consul.discovery.enabled=true
spring.cloud.consul.discovery.register=true
spring.cloud.consul.discovery.instance-id=${spring.application.name}:${server.port}
spring.cloud.consul.discovery.health-check-critical-timeout=10s
</code></pre></div><p>注：</p> <p>其中最关键配置：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.gateway.discovery.locator.enabled=true
</code></pre></div><p>启用gateway的discovery locator, 岂作用是gateway将从注册发现服务中心获取服务信息，并转发请求到相应服务， 请求url中的第一级path约定为服务名，所以像：</p> <div class="language- extra-class"><pre class="language-text"><code>http://localhost:9999/consumer/test
</code></pre></div><p>这样的url，表示gateway将查找consumer名字的服务，并将请求以/test路径转发到consumer微服务</p> <h2 id="四、运行验证"><a href="#四、运行验证" aria-hidden="true" class="header-anchor">#</a> 四、运行验证</h2> <h3 id="_1-确保已经启动：consul，-provider，-consumer"><a href="#_1-确保已经启动：consul，-provider，-consumer" aria-hidden="true" class="header-anchor">#</a> 1. 确保已经启动：consul， provider， consumer</h3> <h3 id="_2-启动gateway"><a href="#_2-启动gateway" aria-hidden="true" class="header-anchor">#</a> 2. 启动gateway</h3> <p>查看consul管理后台，看是否已经注册了provider，consumer，gateway这几个服务</p> <h3 id="_3-浏览器访问consul管理后台：http-localhost-8500"><a href="#_3-浏览器访问consul管理后台：http-localhost-8500" aria-hidden="true" class="header-anchor">#</a> 3. 浏览器访问consul管理后台：http://localhost:8500</h3> <p><img src="/assets/img/consul.325e2c01.jpeg" alt="图片" title="图片"></p> <h3 id="_4-浏览器访问"><a href="#_4-浏览器访问" aria-hidden="true" class="header-anchor">#</a> 4. 浏览器访问</h3> <p>(1) http://localhost:9999/consumer/test</p> <p>(2) http://localhost:9999/provider/test</p> <p>查看是否正确返回json</p> <p>启动多个consumer实例，多个provider实例，观察是否已经有负载均衡的效果</p> <p>停止一个或多个consumer实例，或停止provider实例，看网关的负载均衡是否仍然正常工作</p> <h2 id="五、todo"><a href="#五、todo" aria-hidden="true" class="header-anchor">#</a> 五、Todo</h2> <ul><li>用户认证和用户信息转发</li> <li>业务日志</li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#一、准备工作" title="一、准备工作">一、准备工作</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1-docker-容器" title="1. docker &amp; 容器">1. docker &amp; 容器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-consul注册发现服务中心" title="2. consul注册发现服务中心">2. consul注册发现服务中心</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-provider微服务" title="3. Provider微服务">3. Provider微服务</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-consumer微服务" title="4. consumer微服务">4. consumer微服务</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#二、api网关概念和作用" title="二、API网关概念和作用">二、API网关概念和作用</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#角色和概念：" title="角色和概念：">角色和概念：</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#主要作用：" title="主要作用：">主要作用：</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#三、intellij-idea创建module" title="三、Intellij IDEA创建module">三、Intellij IDEA创建module</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1-选择spring-initializr创建名字为gateway的module，dependencies选择" title="1. 选择Spring Initializr创建名字为gateway的module，dependencies选择">1. 选择Spring Initializr创建名字为gateway的module，dependencies选择</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-修改配置文件src-main-resources-application-properties" title="2. 修改配置文件src/main/resources/application.properties:">2. 修改配置文件src/main/resources/application.properties:</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#四、运行验证" title="四、运行验证">四、运行验证</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_1-确保已经启动：consul，-provider，-consumer" title="1. 确保已经启动：consul， provider， consumer">1. 确保已经启动：consul， provider， consumer</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-启动gateway" title="2. 启动gateway">2. 启动gateway</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-浏览器访问consul管理后台：http-localhost-8500" title="3. 浏览器访问consul管理后台：http://localhost:8500">3. 浏览器访问consul管理后台：http://localhost:8500</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-浏览器访问" title="4. 浏览器访问">4. 浏览器访问</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#五、todo" title="五、Todo">五、Todo</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://github.com/shineyjg" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-fdbf4940><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-fdbf4940></path></svg>
          
        </a></li><li class="contact-item" data-v-fdbf4940><a href="mailto:shineyjg@gmail.com" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-fdbf4940><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-fdbf4940></path><polyline points="22,6 12,13 2,6" data-v-fdbf4940></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/" class="nav-link" data-v-fdbf4940>Vincent © 2020</a></li></ul></div></footer></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="/assets/js/app.2f09ff3d.js" defer></script><script src="/assets/js/5.74ec0765.js" defer></script><script src="/assets/js/24.53c1b64a.js" defer></script>
  </body>
</html>
